---
title: 和訳表示サイトのNext.jsの移行作業
date: 2023-08-18
description: 今行っている和訳表示サイトのNext.jsへの移行作業についての話
---

<!-- markdownlint-disable MD025 MD033 -->

# 和訳表示サイトのNext.jsの移行作業

## 和訳表示サイトとは

[和訳表示サイト](https://chakkun1121.github.io/view-english/)は英文とその日本語訳が含まれた和訳ファイル(.wayaku)の作成、編集とその和訳ファイルをもとにフラッシュカード機能があります。

## 今までの課題

(端的に言うと)**中身がスパゲティーコードである**

### 理由

- はじめと今とでの和訳ファイルの形式が違うが同じ拡張子で使い続けている(はじめはhtmlの断片(これが初めてのwebアプリ作成だった)、今はxml)
- タブ機能を実装している(これが一番大きい)

### 今までの課題の解決方法

- objectでタブの中身を保持しておく(バグが多発し、メンテナンスが大変(てか不可状態だった))
- iframeでタブ部分を埋め込む(バグは減ったがでも依然として残っている。また、パフォーマンス的に問題あり)

## 今回の解決方法

next.jsのLink機能を使用する。

### この方法のメリット

- タブの切り替えをURLの置き換えで表現できる →新しいウィンドウで開くことが簡単になる、戻るや複製といったブラウザの機能を使用できる

## 今回の移行の前に思ったこと

タブ機能いらないのでは?

### 理由

[chromeがpwaでタブ機能を実装しようとしている](https://www.xda-developers.com/google-chrome-tab-strip-progressive-web-apps/)から。

### やはりタブ機能を残す理由

結局以下の理由からしばらくはタブ機能を残します。

- chromeのpwaのタブ機能はまだ実装されていない
- (flagを有効にして試したが)タブの切り替えが面倒
- スマホでは多分実装されない
- いつかelectronを使ってデスクトップアプリ化したい

## 今回の移行で変えること

nextjsを使うこと以外に以下のことを変更します。

- UI (今までのが古いUIだったので今風なUI(丸いボタンなど)に変更する)
- 和訳ファイルの処理部分(今までは正規表現やブラウザのxmlパーサーを使用していたが、今回は[fast-xml-parser](https://github.com/NaturalIntelligence/fast-xml-parser#readme)を使用する)

## 終わりに

まだ本題に入っていませんが、いま移行作業の真っ最中です。定期的に進行状況を報告します。
