---
title: このブログの改良
date: 2023-08-23
tags: [blog]
page: 1
description: このブログに複数ページ機能をつけた話
---

<!-- markdownlint-disable MD025 MD033 -->

# このブログの改造について

## はじめに

本日、このブログに複数ページ機能をつけました。その改造点について書きます。ちなみにこのページも複数ページに別れています。[次のページへ](./2)

## 経緯

このブログを始めたときから複数ページにできるようにしようとしていました。[証拠](../20230803)

ただ、そのときはリダイレクト方法がわからなかったので /posts/20230803 にアクセスしたときと /posts/20230803/1 にアクセスしたときで同じページが表示されていました。それによって、内部リンクが機能していなかったので今回改良しました。

## 改良点

### 1. isMultiplePageArticleの追加

まず、複数ページかそうでないかがわからないとこのパスはリダイレクト対象かがわからないので、複数ページかどうかを判定する関数を追加しました。この関数は渡されたtitleをもとに/posts/${title}/1.mdが存在するかどうかを判定します。

### 2. fileToHtmlの責務の分離

何故かもとはfileToHtml関数はmdファイルをhtmlに変換するだけではなくそのヘッターにある情報も取得していました。それをhtmlに変換するだけにしました。そして、そのヘッダー情報を取得する関数は別に分けました。

### 3. getArticleData関数の作成

これはもともとfileToHtmlにあったmdファイルのヘッターを取得する機能を分離した関数です。ただ、複数ページ対応で1ページ目と同じところ(titleやdescription)は2ページ目以降は書かなくても自動で反映されるようにしました。

これは1ページの情報(firstPageData)とその表示するページのデータ(data)を合成する部分です。

```ts
return {
    ...firstPageData,
    ...data,
  };
}
```

最初にfirstPageDataを展開してからdataを展開することで、dataの方にあるkeyの情報はfirstPageDataにある情報で上書きされ、dataの方にないkeyの値はfirstPageDataにある情報をそのまま使うことができます。

### 4. リダイレクト処理

これは /page/\[title] にアクセスされたときに複数ページの記事の場合は /posts/\[title]/1 にリダイレクトする処理です。このリダイレクト方法は別の記事で書きます。
